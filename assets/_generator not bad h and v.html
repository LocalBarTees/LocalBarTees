<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Bar Tees QR Code Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 50%, #fecaca 100%);
            font-family: 'Inter', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(135deg, #d97706 0%, #ea580c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-button {
            background: linear-gradient(135deg, #d97706 0%, #ea580c 100%);
        }
        .gradient-button:hover {
            background: linear-gradient(135deg, #b45309 0%, #c2410c 100%);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex justify-start mb-4">
                <button
                    id="backBtn"
                    class="flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all duration-200 font-medium"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back
                </button>
            </div>
            <div class="inline-flex items-center justify-center w-16 h-16 gradient-button rounded-2xl mb-4">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                </svg>
            </div>
            <h1 class="text-4xl font-bold gradient-text mb-2">
                Local Bar Tees QR Code Generator
            </h1>
            <p class="text-gray-600 text-lg">Business Card SVG Generator</p>
        </div>

        <!-- Main Content -->
        <div class="bg-white rounded-3xl shadow-2xl p-8">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Input Section -->
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Enter Details</h2>
                    
                    <div>
                        <input
                            type="text"
                            id="idInput"
                            placeholder="ID/Handle/Stem"
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"
                        />
                    </div>
                    
                    <div>
                        <input
                            type="text"
                            id="businessNameInput"
                            placeholder="Business Name"
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"
                        />
                    </div>
                    
                    <div>
                        <input
                            type="text"
                            id="storeNameInput"
                            placeholder="Store Nickname"
                            value="Merch"
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"
                        />
                    </div>

                    <button
                        id="generateBtn"
                        class="w-full flex items-center justify-center gap-2 px-6 py-3 gradient-button text-white rounded-xl hover:opacity-90 transition-all duration-200 font-medium shadow-lg"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Generate QR Codes
                    </button>
                </div>

                <!-- QR Code Display Section -->
                <div class="flex flex-col items-center space-y-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Business Card QR Codes</h2>
                    
                    <!-- Landscape Version (Standard business card) -->
                    <div class="bg-gray-50 rounded-2xl p-4 w-full">
                        <h3 class="text-lg font-medium text-gray-700 mb-3 text-center">Landscape (3.5" × 2")</h3>
                        <div id="qrContainerLandscape" class="text-center flex items-center justify-center">
                            <p class="text-gray-500 text-sm">Click Generate to create QR codes</p>
                        </div>
                    </div>

                    <!-- Portrait Version -->
                    <div class="bg-gray-50 rounded-2xl p-4 w-full">
                        <h3 class="text-lg font-medium text-gray-700 mb-3 text-center">Portrait (2" × 3.5")</h3>
                        <div id="qrContainerPortrait" class="text-center flex items-center justify-center">
                            <p class="text-gray-500 text-sm">Click Generate to create QR codes</p>
                        </div>
                    </div>

                    <div id="actionButtons" class="flex gap-4 w-full" style="display: none;">
                        <button
                            id="downloadLandscapeBtn"
                            class="flex-1 flex items-center justify-center gap-2 px-4 py-3 gradient-button text-white rounded-xl hover:opacity-90 transition-all duration-200 font-medium shadow-lg"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                            Landscape SVG
                        </button>
                        <button
                            id="downloadPortraitBtn"
                            class="flex-1 flex items-center justify-center gap-2 px-4 py-3 gradient-button text-white rounded-xl hover:opacity-90 transition-all duration-200 font-medium shadow-lg"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                            Portrait SVG
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        var currentUrl = '';
        var businessNameInput = document.getElementById('businessNameInput');
        var storeNameInput = document.getElementById('storeNameInput');
        var idInput = document.getElementById('idInput');
        var backBtn = document.getElementById('backBtn');
        var generateBtn = document.getElementById('generateBtn');
        var qrContainerPortrait = document.getElementById('qrContainerPortrait');
        var qrContainerLandscape = document.getElementById('qrContainerLandscape');
        var actionButtons = document.getElementById('actionButtons');
        var downloadPortraitBtn = document.getElementById('downloadPortraitBtn');
        var downloadLandscapeBtn = document.getElementById('downloadLandscapeBtn');

        var portraitSvg = '';
        var landscapeSvg = '';

        // Build URL from form inputs
        function buildURL() {
            var baseUrl = 'https://localbartees.com';
            var id = idInput.value.trim().toLowerCase();
            
            if (id) {
                baseUrl += '/' + id;
            }
            
            return baseUrl;
        }

        // Generate QR code data (SVG path)
        function generateQRData() {
            var url = buildURL();
            currentUrl = url;
            
            if (!url.trim()) {
                url = 'https://localbartees.com';
            }

            // Add ?qr=yes parameter
            var qrUrl = url;
            if (qrUrl.indexOf('?') === -1) {
                qrUrl = qrUrl + '?qr=yes';
            } else {
                qrUrl = qrUrl + '&qr=yes';
            }

            // Show loading
            qrContainerPortrait.innerHTML = '<p class="text-gray-500">Generating...</p>';
            qrContainerLandscape.innerHTML = '<p class="text-gray-500">Generating...</p>';

            var encodedData = encodeURIComponent(qrUrl);
            var apiUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=' + encodedData + '&format=svg&margin=0';
            
            return fetch(apiUrl)
                .then(response => response.text())
                .then(svgText => {
                    createBothSVGs(svgText);
                })
                .catch(error => {
                    console.error('Error generating QR code:', error);
                    qrContainerPortrait.innerHTML = '<p class="text-red-500">Error generating QR code</p>';
                    qrContainerLandscape.innerHTML = '<p class="text-red-500">Error generating QR code</p>';
                });
        }

        // Create both portrait and landscape SVGs
        function createBothSVGs(qrSvgContent) {
            var businessName = businessNameInput.value.trim();
            var storeName = storeNameInput.value.trim();
            
            // Extract SVG path from QR SVG content
            var parser = new DOMParser();
            var qrDoc = parser.parseFromString(qrSvgContent, 'image/svg+xml');
            var qrPaths = qrDoc.querySelectorAll('path, rect');
            var qrPathsString = '';
            qrPaths.forEach(function(path) {
                qrPathsString += path.outerHTML;
            });

            // Create landscape SVG (3.5" wide x 2" tall) - Standard business card
            landscapeSvg = createLandscapeSVG(qrPathsString, businessName, storeName);
            
            // Create portrait SVG (2" wide x 3.5" tall)
            portraitSvg = createPortraitSVG(qrPathsString, businessName, storeName);

            // Display both SVGs with proper aspect ratios
            displaySVG(qrContainerLandscape, landscapeSvg, '350px'); // Wider for landscape
            displaySVG(qrContainerPortrait, portraitSvg, '200px');   // Narrower for portrait
            
            actionButtons.style.display = 'flex';
        }

        // Helper function to fit text within available width
        function createTextElement(text, x, y, maxWidth, fontSize, className) {
            // Rough estimation: average character width is about 60% of font size
            var avgCharWidth = fontSize * 0.6;
            var estimatedWidth = text.length * avgCharWidth;
            
            if (estimatedWidth > maxWidth) {
                // If text is too long, reduce font size to fit
                var scaleFactor = maxWidth / estimatedWidth;
                fontSize = Math.max(fontSize * scaleFactor, 8); // Minimum font size of 8
            }
            
            return `<text x="${x}" y="${y}" font-size="${fontSize}" class="${className}">${text}</text>`;
        }

        // Create landscape SVG (3.5" × 2" = 252pt × 144pt)
        function createLandscapeSVG(qrPaths, businessName, storeName) {
            var width = 252;  // 3.5 inches * 72pt/inch  
            var height = 144; // 2 inches * 72pt/inch
            var qrSize = 100; // QR code size in points
            var qrPadding = 8; // White space inside QR border
            var qrBorderWidth = 2; // Black border thickness
            var qrTotalSize = qrSize + (qrPadding * 2) + (qrBorderWidth * 2); // Total QR area
            var cardPadding = 12;
            var borderRadius = 8;
            
            var svg = `<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <style>
                        .business-text { font-family: 'Inter', Arial, sans-serif; font-weight: bold; fill: white; }
                        .store-text { font-family: 'Inter', Arial, sans-serif; font-weight: bold; fill: white; }
                        .powered-text { font-family: 'Inter', Arial, sans-serif; font-weight: normal; fill: white; }
                    </style>
                </defs>
                
                <!-- Green background with black border -->
                <rect width="${width}" height="${height}" fill="#22c55e" stroke="#000000" stroke-width="2" rx="${borderRadius}" ry="${borderRadius}"/>
                
                <!-- Black rounded border for QR -->
                <rect x="${cardPadding}" y="${(height - qrTotalSize) / 2}" width="${qrTotalSize}" height="${qrTotalSize}" 
                      fill="#000000" rx="8" ry="8"/>
                
                <!-- White background inside border -->
                <rect x="${cardPadding + qrBorderWidth}" y="${(height - qrTotalSize) / 2 + qrBorderWidth}" 
                      width="${qrSize + (qrPadding * 2)}" height="${qrSize + (qrPadding * 2)}" 
                      fill="white" rx="6" ry="6"/>
                
                <!-- QR Code centered and middled in the white area -->
                <g transform="translate(${cardPadding + qrBorderWidth + qrPadding}, ${(height - qrSize) / 2}) scale(${qrSize / 300})">
                    ${qrPaths}
                </g>`;

            var textStartX = cardPadding + qrTotalSize + 16;
            var centerY = height / 2;

            if (businessName && storeName) {
                svg += `<text x="${textStartX}" y="${centerY - 15}" font-size="20" class="business-text">${businessName}</text>`;
                svg += `<text x="${textStartX}" y="${centerY + 5}" font-size="16" class="store-text">${storeName}</text>`;
                svg += `<text x="${textStartX}" y="${centerY + 25}" font-size="10" class="powered-text">Powered by localbartees.com</text>`;
            } else if (businessName) {
                svg += `<text x="${textStartX}" y="${centerY - 5}" font-size="22" class="business-text">${businessName}</text>`;
                svg += `<text x="${textStartX}" y="${centerY + 20}" font-size="10" class="powered-text">Powered by localbartees.com</text>`;
            } else if (storeName) {
                svg += `<text x="${textStartX}" y="${centerY - 5}" font-size="22" class="store-text">${storeName}</text>`;
                svg += `<text x="${textStartX}" y="${centerY + 20}" font-size="10" class="powered-text">Powered by localbartees.com</text>`;
            } else {
                svg += `<text x="${textStartX}" y="${centerY}" font-size="14" class="powered-text">Powered by localbartees.com</text>`;
            }
            
            svg += '</svg>';
            return svg;
        }

        // Create portrait SVG (2" × 3.5" = 144pt × 252pt)
        function createPortraitSVG(qrPaths, businessName, storeName) {
            var width = 144;  // 2 inches * 72pt/inch
            var height = 252; // 3.5 inches * 72pt/inch
            var qrSize = 100; // QR code size in points
            var qrPadding = 8; // White space inside QR border
            var qrBorderWidth = 2; // Black border thickness
            var qrTotalSize = qrSize + (qrPadding * 2) + (qrBorderWidth * 2); // Total QR area
            var cardPadding = 12;
            var borderRadius = 8;
            
            var svg = `<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <style>
                        .business-text { font-family: 'Inter', Arial, sans-serif; font-weight: bold; fill: white; }
                        .store-text { font-family: 'Inter', Arial, sans-serif; font-weight: bold; fill: white; }
                        .powered-text { font-family: 'Inter', Arial, sans-serif; font-weight: normal; fill: white; }
                    </style>
                </defs>
                
                <!-- Green background with black border -->
                <rect width="${width}" height="${height}" fill="#22c55e" stroke="#000000" stroke-width="2" rx="${borderRadius}" ry="${borderRadius}"/>
                
                <!-- Black rounded border for QR -->
                <rect x="${(width - qrTotalSize) / 2}" y="${cardPadding}" width="${qrTotalSize}" height="${qrTotalSize}" 
                      fill="#000000" rx="8" ry="8"/>
                
                <!-- White background inside border -->
                <rect x="${(width - qrTotalSize) / 2 + qrBorderWidth}" y="${cardPadding + qrBorderWidth}" 
                      width="${qrSize + (qrPadding * 2)}" height="${qrSize + (qrPadding * 2)}" 
                      fill="white" rx="6" ry="6"/>
                
                <!-- QR Code centered and middled in the white area -->
                <g transform="translate(${(width - qrSize) / 2}, ${cardPadding + qrBorderWidth + qrPadding}) scale(${qrSize / 300})">
                    ${qrPaths}
                </g>`;

            var textStartY = cardPadding + qrTotalSize + 30;
            var currentY = textStartY;

            if (businessName) {
                svg += `<text x="${width/2}" y="${currentY}" text-anchor="middle" font-size="22" class="business-text">${businessName}</text>`;
                currentY += 30;
            }
            
            if (storeName) {
                svg += `<text x="${width/2}" y="${currentY}" text-anchor="middle" font-size="18" class="store-text">${storeName}</text>`;
                currentY += 25;
            }

            svg += `<text x="${width/2}" y="${height - 20}" text-anchor="middle" font-size="10" class="powered-text">Powered by localbartees.com</text>`;
            
            svg += '</svg>';
            return svg;
        }

        // Display SVG in container with proper aspect ratio
        function displaySVG(container, svgContent, maxWidth) {
            container.innerHTML = `<div class="flex justify-center">
                <div style="max-width: ${maxWidth}; width: 100%;">
                    ${svgContent}
                </div>
            </div>`;
        }

        // Download SVG file
        function downloadSVG(svgContent, filename) {
            var blob = new Blob([svgContent], { type: 'image/svg+xml' });
            var url = URL.createObjectURL(blob);
            var link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Download portrait version
        function downloadPortrait() {
            if (!portraitSvg) return;
            var id = idInput.value.trim().toLowerCase();
            var filename = id ? `qr_${id}_portrait_2x3.5.svg` : 'qr_portrait_2x3.5.svg';
            downloadSVG(portraitSvg, filename);
        }

        // Download landscape version
        function downloadLandscape() {
            if (!landscapeSvg) return;
            var id = idInput.value.trim().toLowerCase();
            var filename = id ? `qr_${id}_landscape_3.5x2.svg` : 'qr_landscape_3.5x2.svg';
            downloadSVG(landscapeSvg, filename);
        }

        // Go back in browser history
        function goBack() {
            window.history.back();
        }

        // Event listeners
        backBtn.addEventListener('click', goBack);
        generateBtn.addEventListener('click', generateQRData);
        downloadPortraitBtn.addEventListener('click', downloadPortrait);
        downloadLandscapeBtn.addEventListener('click', downloadLandscape);
    </script>
</body>
</html>